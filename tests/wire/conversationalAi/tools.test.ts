/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool.js";
import { ElevenLabsClient } from "../../../src/Client";

describe("Tools", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = {
            tools: [
                {
                    id: "id",
                    tool_config: {
                        name: "name",
                        description: "description",
                        expects_response: false,
                        dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                        type: "client",
                    },
                    access_info: {
                        is_creator: true,
                        creator_name: "John Doe",
                        creator_email: "john.doe@example.com",
                        role: "admin",
                    },
                },
            ],
        };
        server.mockEndpoint().get("/v1/convai/tools").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.conversationalAi.tools.list();
        expect(response).toEqual({
            tools: [
                {
                    id: "id",
                    toolConfig: {
                        type: "client",
                        name: "name",
                        description: "description",
                        expectsResponse: false,
                        dynamicVariables: {
                            dynamicVariablePlaceholders: {
                                user_name: "John Doe",
                            },
                        },
                    },
                    accessInfo: {
                        isCreator: true,
                        creatorName: "John Doe",
                        creatorEmail: "john.doe@example.com",
                        role: "admin",
                    },
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });
        const rawRequestBody = {
            tool_config: { name: "name", description: "description", expects_response: false, type: "client" },
        };
        const rawResponseBody = {
            id: "id",
            tool_config: {
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamic_variable: "Dynamic variable",
                            constant_value: "Constant value",
                        },
                    },
                },
                expects_response: false,
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                type: "client",
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
        };
        server
            .mockEndpoint()
            .post("/v1/convai/tools")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.create({
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                expectsResponse: false,
            },
        });
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamicVariable: "Dynamic variable",
                            constantValue: "Constant value",
                        },
                    },
                },
                expectsResponse: false,
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = {
            id: "id",
            tool_config: {
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamic_variable: "Dynamic variable",
                            constant_value: "Constant value",
                        },
                    },
                },
                expects_response: false,
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                type: "client",
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
        };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.get("tool_id");
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamicVariable: "Dynamic variable",
                            constantValue: "Constant value",
                        },
                    },
                },
                expectsResponse: false,
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.delete("tool_id");
        expect(response).toEqual({
            key: "value",
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });
        const rawRequestBody = {
            tool_config: { name: "name", description: "description", expects_response: false, type: "client" },
        };
        const rawResponseBody = {
            id: "id",
            tool_config: {
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamic_variable: "Dynamic variable",
                            constant_value: "Constant value",
                        },
                    },
                },
                expects_response: false,
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                type: "client",
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
        };
        server
            .mockEndpoint()
            .patch("/v1/convai/tools/tool_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.update("tool_id", {
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                expectsResponse: false,
            },
        });
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamicVariable: "Dynamic variable",
                            constantValue: "Constant value",
                        },
                    },
                },
                expectsResponse: false,
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
        });
    });

    test("get_dependent_agents", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = {
            agents: [{ id: "id", name: "name", created_at_unix_secs: 1, access_level: "admin", type: "available" }],
            next_cursor: "next_cursor",
            has_more: true,
        };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id/dependent-agents")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.getDependentAgents("tool_id");
        expect(response).toEqual({
            agents: [
                {
                    type: "available",
                    id: "id",
                    name: "name",
                    createdAtUnixSecs: 1,
                    accessLevel: "admin",
                },
            ],
            nextCursor: "next_cursor",
            hasMore: true,
        });
    });
});
