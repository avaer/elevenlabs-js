/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../mock-server/MockServerPool";
import { ElevenLabsClient } from "../../../src/Client";
import * as ElevenLabs from "../../../src/api/index";

describe("Tools", () => {
    test("list (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            tools: [
                {
                    id: "id",
                    tool_config: {
                        type: "client",
                        name: "name",
                        description: "description",
                        assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                        expects_response: false,
                        dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
                    },
                    access_info: {
                        is_creator: true,
                        creator_name: "John Doe",
                        creator_email: "john.doe@example.com",
                        role: "admin",
                    },
                    usage_stats: { avg_latency_secs: 1.1 },
                },
            ],
        };
        server.mockEndpoint().get("/v1/convai/tools").respondWith().statusCode(200).jsonBody(rawResponseBody).build();

        const response = await client.conversationalAi.tools.list();
        expect(response).toEqual({
            tools: [
                {
                    id: "id",
                    toolConfig: {
                        type: "client",
                        name: "name",
                        description: "description",
                        assignments: [
                            {
                                source: "response",
                                dynamicVariable: "user_name",
                                valuePath: "user.name",
                            },
                        ],
                        expectsResponse: false,
                        dynamicVariables: {
                            dynamicVariablePlaceholders: {
                                user_name: "John Doe",
                            },
                        },
                    },
                    accessInfo: {
                        isCreator: true,
                        creatorName: "John Doe",
                        creatorEmail: "john.doe@example.com",
                        role: "admin",
                    },
                    usageStats: {
                        avgLatencySecs: 1.1,
                    },
                },
            ],
        });
    });

    test("list (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: undefined };
        server.mockEndpoint().get("/v1/convai/tools").respondWith().statusCode(422).jsonBody(rawResponseBody).build();

        await expect(async () => {
            return await client.conversationalAi.tools.list();
        }).rejects.toThrow(ElevenLabs.UnprocessableEntityError);
    });

    test("create (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            tool_config: { type: "client", name: "name", description: "description", expects_response: false },
        };
        const rawResponseBody = {
            id: "id",
            tool_config: {
                type: "client",
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                disable_interruptions: true,
                force_pre_tool_speech: true,
                assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamic_variable: "Dynamic variable",
                            constant_value: "Constant value",
                        },
                    },
                },
                expects_response: false,
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            usage_stats: { total_calls: 1, avg_latency_secs: 1.1 },
        };
        server
            .mockEndpoint()
            .post("/v1/convai/tools")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.create({
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                expectsResponse: false,
            },
        });
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                disableInterruptions: true,
                forcePreToolSpeech: true,
                assignments: [
                    {
                        source: "response",
                        dynamicVariable: "user_name",
                        valuePath: "user.name",
                    },
                ],
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamicVariable: "Dynamic variable",
                            constantValue: "Constant value",
                        },
                    },
                },
                expectsResponse: false,
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            usageStats: {
                totalCalls: 1,
                avgLatencySecs: 1.1,
            },
        });
    });

    test("create (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            tool_config: {
                type: "client",
                name: "name",
                description: "description",
                response_timeout_secs: undefined,
                disable_interruptions: undefined,
                force_pre_tool_speech: undefined,
                assignments: undefined,
                parameters: undefined,
                expects_response: undefined,
                dynamic_variables: undefined,
            },
        };
        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .post("/v1/convai/tools")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.conversationalAi.tools.create({
                toolConfig: {
                    type: "client",
                    name: "name",
                    description: "description",
                    responseTimeoutSecs: undefined,
                    disableInterruptions: undefined,
                    forcePreToolSpeech: undefined,
                    assignments: undefined,
                    parameters: undefined,
                    expectsResponse: undefined,
                    dynamicVariables: undefined,
                },
            });
        }).rejects.toThrow(ElevenLabs.UnprocessableEntityError);
    });

    test("get (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            id: "id",
            tool_config: {
                type: "client",
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                disable_interruptions: true,
                force_pre_tool_speech: true,
                assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamic_variable: "Dynamic variable",
                            constant_value: "Constant value",
                        },
                    },
                },
                expects_response: false,
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            usage_stats: { total_calls: 1, avg_latency_secs: 1.1 },
        };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.get("tool_id");
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                disableInterruptions: true,
                forcePreToolSpeech: true,
                assignments: [
                    {
                        source: "response",
                        dynamicVariable: "user_name",
                        valuePath: "user.name",
                    },
                ],
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamicVariable: "Dynamic variable",
                            constantValue: "Constant value",
                        },
                    },
                },
                expectsResponse: false,
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            usageStats: {
                totalCalls: 1,
                avgLatencySecs: 1.1,
            },
        });
    });

    test("get (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.conversationalAi.tools.get("tool_id");
        }).rejects.toThrow(ElevenLabs.UnprocessableEntityError);
    });

    test("delete (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .delete("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.delete("tool_id");
        expect(response).toEqual({
            key: "value",
        });
    });

    test("delete (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .delete("/v1/convai/tools/tool_id")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.conversationalAi.tools.delete("tool_id");
        }).rejects.toThrow(ElevenLabs.UnprocessableEntityError);
    });

    test("update (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            tool_config: { type: "client", name: "name", description: "description", expects_response: false },
        };
        const rawResponseBody = {
            id: "id",
            tool_config: {
                type: "client",
                name: "name",
                description: "description",
                response_timeout_secs: 1,
                disable_interruptions: true,
                force_pre_tool_speech: true,
                assignments: [{ source: "response", dynamic_variable: "user_name", value_path: "user.name" }],
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamic_variable: "Dynamic variable",
                            constant_value: "Constant value",
                        },
                    },
                },
                expects_response: false,
                dynamic_variables: { dynamic_variable_placeholders: { user_name: "John Doe" } },
            },
            access_info: {
                is_creator: true,
                creator_name: "John Doe",
                creator_email: "john.doe@example.com",
                role: "admin",
            },
            usage_stats: { total_calls: 1, avg_latency_secs: 1.1 },
        };
        server
            .mockEndpoint()
            .patch("/v1/convai/tools/tool_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.update("tool_id", {
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                expectsResponse: false,
            },
        });
        expect(response).toEqual({
            id: "id",
            toolConfig: {
                type: "client",
                name: "name",
                description: "description",
                responseTimeoutSecs: 1,
                disableInterruptions: true,
                forcePreToolSpeech: true,
                assignments: [
                    {
                        source: "response",
                        dynamicVariable: "user_name",
                        valuePath: "user.name",
                    },
                ],
                parameters: {
                    type: "object",
                    required: ["required"],
                    description: "description",
                    properties: {
                        key: {
                            type: "string",
                            description: "My property",
                            dynamicVariable: "Dynamic variable",
                            constantValue: "Constant value",
                        },
                    },
                },
                expectsResponse: false,
                dynamicVariables: {
                    dynamicVariablePlaceholders: {
                        user_name: "John Doe",
                    },
                },
            },
            accessInfo: {
                isCreator: true,
                creatorName: "John Doe",
                creatorEmail: "john.doe@example.com",
                role: "admin",
            },
            usageStats: {
                totalCalls: 1,
                avgLatencySecs: 1.1,
            },
        });
    });

    test("update (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            tool_config: {
                type: "client",
                name: "name",
                description: "description",
                response_timeout_secs: undefined,
                disable_interruptions: undefined,
                force_pre_tool_speech: undefined,
                assignments: undefined,
                parameters: undefined,
                expects_response: undefined,
                dynamic_variables: undefined,
            },
        };
        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .patch("/v1/convai/tools/tool_id")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.conversationalAi.tools.update("tool_id", {
                toolConfig: {
                    type: "client",
                    name: "name",
                    description: "description",
                    responseTimeoutSecs: undefined,
                    disableInterruptions: undefined,
                    forcePreToolSpeech: undefined,
                    assignments: undefined,
                    parameters: undefined,
                    expectsResponse: undefined,
                    dynamicVariables: undefined,
                },
            });
        }).rejects.toThrow(ElevenLabs.UnprocessableEntityError);
    });

    test("get_dependent_agents (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = {
            agents: [{ type: "available", id: "id", name: "name", created_at_unix_secs: 1, access_level: "admin" }],
            next_cursor: "next_cursor",
            has_more: true,
        };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id/dependent-agents")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.conversationalAi.tools.getDependentAgents("tool_id", {
            cursor: "cursor",
            pageSize: 1,
        });
        expect(response).toEqual({
            agents: [
                {
                    type: "available",
                    id: "id",
                    name: "name",
                    createdAtUnixSecs: 1,
                    accessLevel: "admin",
                },
            ],
            nextCursor: "next_cursor",
            hasMore: true,
        });
    });

    test("get_dependent_agents (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({ apiKey: "test", environment: server.baseUrl });

        const rawResponseBody = { detail: undefined };
        server
            .mockEndpoint()
            .get("/v1/convai/tools/tool_id/dependent-agents")
            .respondWith()
            .statusCode(422)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.conversationalAi.tools.getDependentAgents("tool_id");
        }).rejects.toThrow(ElevenLabs.UnprocessableEntityError);
    });
});
