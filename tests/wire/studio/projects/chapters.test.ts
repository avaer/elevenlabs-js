/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../../../mock-server/MockServerPool.js";
import { ElevenLabsClient } from "../../../../src/Client";

describe("Chapters", () => {
    test("list", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = {
            chapters: [
                {
                    chapter_id: "aw1NgEzBg83R7vgmiJt6",
                    name: "Chapter 1",
                    last_conversion_date_unix: 1714204800,
                    conversion_progress: 0.5,
                    can_be_downloaded: true,
                    state: "converting",
                    statistics: {
                        characters_unconverted: 1000,
                        characters_converted: 500,
                        paragraphs_converted: 20,
                        paragraphs_unconverted: 10,
                    },
                    last_conversion_error: "Error message",
                },
            ],
        };
        server
            .mockEndpoint()
            .get("/v1/studio/projects/21m00Tcm4TlvDq8ikWAM/chapters")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.studio.projects.chapters.list("21m00Tcm4TlvDq8ikWAM");
        expect(response).toEqual({
            chapters: [
                {
                    chapterId: "aw1NgEzBg83R7vgmiJt6",
                    name: "Chapter 1",
                    lastConversionDateUnix: 1714204800,
                    conversionProgress: 0.5,
                    canBeDownloaded: true,
                    state: "converting",
                    statistics: {
                        charactersUnconverted: 1000,
                        charactersConverted: 500,
                        paragraphsConverted: 20,
                        paragraphsUnconverted: 10,
                    },
                    lastConversionError: "Error message",
                },
            ],
        });
    });

    test("create", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });
        const rawRequestBody = { name: "Chapter 1" };
        const rawResponseBody = {
            chapter: {
                chapter_id: "aw1NgEzBg83R7vgmiJt6",
                name: "Chapter 1",
                last_conversion_date_unix: 1714204800,
                conversion_progress: 0.5,
                can_be_downloaded: true,
                state: "converting",
                statistics: {
                    characters_unconverted: 1000,
                    characters_converted: 500,
                    paragraphs_converted: 20,
                    paragraphs_unconverted: 10,
                },
                last_conversion_error: "Error message",
                content: {
                    blocks: [
                        { block_id: "block_id", nodes: [{ voice_id: "voice_id", text: "text", type: "tts_node" }] },
                    ],
                },
            },
        };
        server
            .mockEndpoint()
            .post("/v1/studio/projects/21m00Tcm4TlvDq8ikWAM/chapters")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.studio.projects.chapters.create("21m00Tcm4TlvDq8ikWAM", {
            name: "Chapter 1",
        });
        expect(response).toEqual({
            chapter: {
                chapterId: "aw1NgEzBg83R7vgmiJt6",
                name: "Chapter 1",
                lastConversionDateUnix: 1714204800,
                conversionProgress: 0.5,
                canBeDownloaded: true,
                state: "converting",
                statistics: {
                    charactersUnconverted: 1000,
                    charactersConverted: 500,
                    paragraphsConverted: 20,
                    paragraphsUnconverted: 10,
                },
                lastConversionError: "Error message",
                content: {
                    blocks: [
                        {
                            blockId: "block_id",
                            nodes: [
                                {
                                    type: "tts_node",
                                    voiceId: "voice_id",
                                    text: "text",
                                },
                            ],
                        },
                    ],
                },
            },
        });
    });

    test("get", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = {
            chapter_id: "aw1NgEzBg83R7vgmiJt6",
            name: "Chapter 1",
            last_conversion_date_unix: 1714204800,
            conversion_progress: 0.5,
            can_be_downloaded: true,
            state: "converting",
            statistics: {
                characters_unconverted: 1000,
                characters_converted: 500,
                paragraphs_converted: 20,
                paragraphs_unconverted: 10,
            },
            last_conversion_error: "Error message",
            content: {
                blocks: [{ block_id: "block_id", nodes: [{ voice_id: "voice_id", text: "text", type: "tts_node" }] }],
            },
        };
        server
            .mockEndpoint()
            .get("/v1/studio/projects/21m00Tcm4TlvDq8ikWAM/chapters/21m00Tcm4TlvDq8ikWAM")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.studio.projects.chapters.get("21m00Tcm4TlvDq8ikWAM", "21m00Tcm4TlvDq8ikWAM");
        expect(response).toEqual({
            chapterId: "aw1NgEzBg83R7vgmiJt6",
            name: "Chapter 1",
            lastConversionDateUnix: 1714204800,
            conversionProgress: 0.5,
            canBeDownloaded: true,
            state: "converting",
            statistics: {
                charactersUnconverted: 1000,
                charactersConverted: 500,
                paragraphsConverted: 20,
                paragraphsUnconverted: 10,
            },
            lastConversionError: "Error message",
            content: {
                blocks: [
                    {
                        blockId: "block_id",
                        nodes: [
                            {
                                type: "tts_node",
                                voiceId: "voice_id",
                                text: "text",
                            },
                        ],
                    },
                ],
            },
        });
    });

    test("update", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });
        const rawRequestBody = {};
        const rawResponseBody = {
            chapter: {
                chapter_id: "aw1NgEzBg83R7vgmiJt6",
                name: "Chapter 1",
                last_conversion_date_unix: 1714204800,
                conversion_progress: 0.5,
                can_be_downloaded: true,
                state: "converting",
                statistics: {
                    characters_unconverted: 1000,
                    characters_converted: 500,
                    paragraphs_converted: 20,
                    paragraphs_unconverted: 10,
                },
                last_conversion_error: "Error message",
                content: {
                    blocks: [
                        { block_id: "block_id", nodes: [{ voice_id: "voice_id", text: "text", type: "tts_node" }] },
                    ],
                },
            },
        };
        server
            .mockEndpoint()
            .post("/v1/studio/projects/21m00Tcm4TlvDq8ikWAM/chapters/21m00Tcm4TlvDq8ikWAM")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.studio.projects.chapters.update("21m00Tcm4TlvDq8ikWAM", "21m00Tcm4TlvDq8ikWAM");
        expect(response).toEqual({
            chapter: {
                chapterId: "aw1NgEzBg83R7vgmiJt6",
                name: "Chapter 1",
                lastConversionDateUnix: 1714204800,
                conversionProgress: 0.5,
                canBeDownloaded: true,
                state: "converting",
                statistics: {
                    charactersUnconverted: 1000,
                    charactersConverted: 500,
                    paragraphsConverted: 20,
                    paragraphsUnconverted: 10,
                },
                lastConversionError: "Error message",
                content: {
                    blocks: [
                        {
                            blockId: "block_id",
                            nodes: [
                                {
                                    type: "tts_node",
                                    voiceId: "voice_id",
                                    text: "text",
                                },
                            ],
                        },
                    ],
                },
            },
        });
    });

    test("delete", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = { status: "ok" };
        server
            .mockEndpoint()
            .delete("/v1/studio/projects/21m00Tcm4TlvDq8ikWAM/chapters/21m00Tcm4TlvDq8ikWAM")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.studio.projects.chapters.delete("21m00Tcm4TlvDq8ikWAM", "21m00Tcm4TlvDq8ikWAM");
        expect(response).toEqual({
            status: "ok",
        });
    });

    test("convert", async () => {
        const server = mockServerPool.createServer();
        const client = new ElevenLabsClient({
            apiKey: "test",
            environment: { base: server.baseUrl, wss: server.baseUrl },
        });

        const rawResponseBody = { status: "ok" };
        server
            .mockEndpoint()
            .post("/v1/studio/projects/21m00Tcm4TlvDq8ikWAM/chapters/21m00Tcm4TlvDq8ikWAM/convert")
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.studio.projects.chapters.convert("21m00Tcm4TlvDq8ikWAM", "21m00Tcm4TlvDq8ikWAM");
        expect(response).toEqual({
            status: "ok",
        });
    });
});
